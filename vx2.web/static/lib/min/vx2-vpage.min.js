/*! http://www.csii.com.cn/hercules/vx  
* Copyright (c) 2012-2017 CSII 
* @license vx - v2.0 
* 2017-03-16 
*/
!function(window,angular){"use strict";function indexOf(a,b){if(a.indexOf)return a.indexOf(b);for(var c=0,d=a.length;d>c;c++)if(b===a[c])return c;return-1}function ngPageController(a,b,c,d,e,f,g){var h,i=this,j=c.onload,k=c.href;b.hide(),i.$element=b,i.$title=c.title,h=b.parent().data("$viewport"),i.$destroy=function(){i.$element=null},i.$index=parseInt(b.attr("page-index")),i.$load=function(c){function d(){f(b.contents())(a),i.$$loaded=!0,c.apply(h,[i.$index,i])}i.$$loaded?c.apply(h,[i.$index,i]):k?e(k,!0).then(function(a){b.html(a),d()},function(a){console.err(a)}):g.defer(function(){d(),a.$apply(null,"ng-page")})},i.$enable=function(c){b.show(),c&&c(),d.$broadcast("$pageContentLoaded",h.$id,i.$index,k,i.$title),a.$eval(j)},i.$disable=function(){b.hide()}}function ngPageDirective(a,b){return{restrict:"EA",terminal:!0,require:"ngPage",priority:99,controller:ngPageController,link:function(c,d,e,f){var g=d.parent().data("$viewport"),h=d.attr("page-index");"1"===h&&a(function(){b.$loadIndex(g,0)}),d.bind("$destroy",function(){f.$destroy()})}}}function $TargetsProvider(){function Factory(window,$location,$log,$rootScope){function forward(a,b,c){service.$targetProxy(a,b,c)}var TARGET_REG=/^#[+-]?\d+$/,service;return service={$viewports:{},$refreshCall:null,setRefreshCall:function(a){a&&(service.$refreshCall=a)},$addView:function(a,b){var c,d=$location.path();return this.$viewports[d]||(this.$viewports[d]={}),c=this.$viewports[d],c[a]=b,b.saveKey=d,b},$getView:function(a){var b,c=$location.path();return b=this.$viewports[c],b?b[a]:void 0},$destroy:function(a){var b=a.saveKey;this.$viewports[b]&&delete this.$viewports[b]},$viewBack:function(a){var b=this.$getView(a);return b?service.$back(b):!0},$back:function(a){var b=a.$viewContext.stack;return 1===b.length?!0:(b.pop(),void service.$loadIndex(a,b[b.length-1],!0))},$parseUrlExp:function(view,urlExp){var result;if(/^#\d+/.test(urlExp)){var targetNo=urlExp.substr(1);result=targetNo>0?targetNo-1:0}else{if(!/^#[+-]\d+/.test(urlExp))throw Error("urlExp sync Error",urlExp);var history=view.$viewContext.historyPage||0;result=eval(history+urlExp.substr(1))}return result},$updateViewCtx:function(a,b,c){var d=a.$viewContext,e=d.stack;d.historyPage=d.activePage,d.activePage=b,c||d.stack.push(b);var f=e.indexOf(b);f!==e.length-1&&e.splice(f+1,e.length-1),$log.debug("vpage:->"+e.join("->")+",currentPage:"+b+",lastPage:"+d.historyPage)},$loadIndex:function(a,b,c){var d=a.$pages[b],e=d.$element,f=$(e).controller("ngPage"),g=a.$viewContext.activePage;f.$load(function(){if(void 0!==g){var d=a.$pages[g],e=d.$element,h=$(e).controller("ngPage");h.$disable()}f.$enable(function(){service.$updateViewCtx(a,b,c)})})},$targetProxy:function(a,b,c){if(!TARGET_REG.test(b))throw targetError("$target","urlExp sync Error in $target(arg1,{0},arg3) second args!",b);var d=this.$getView(a);if(!d)throw targetError(404,"ngViewport with id {0} isn't exist!",arguments[0]);if("#0"===b&&"function"==typeof service.$refreshCall)service.$refreshCall(d);else{var e=service.$parseUrlExp(d,b);service.$loadIndex(d,e,c)}}},window.$viewports=service.$viewports,angular.extend(forward,service)}Factory.$inject=["$window","$location","$log","$rootScope"],this.$get=Factory}var minErr=angular.$$minErr,targetError=minErr("$targets");ngPageController.$inject=["$scope","$element","$attrs","$rootScope","$templateRequest","$compile","$browser"],ngPageDirective.$inject=["$timeout","$targets"],angular.module("vviewport.vpage",[]),angular.module("vviewport.vpage").provider("$targets",$TargetsProvider).directive("ngPage",ngPageDirective),angular.module("vviewport.vpage").config(["$provide",function(a){a.decorator("ngControllerDirective",["$targets","$log","$delegate",function(a,b,c){var d=c[0];return d.compile=function(){return{pre:function(c,d,e){var f,g,h=[];g=e.viewId||"content",b.debug("vpage:enable view in controller:"+e.ngController);var i,j;i=d.children(),angular.forEach(i,function(a){if(a.hasAttribute("v-page")){j=h.length+1;var b={$element:a,$index:j};a.setAttribute("page-index",j),h.push(b)}}),h.length>0&&(f={$id:g,$pages:h,$viewContext:{historyPage:void 0,activePage:void 0,stack:[]}},d.data("$viewport",f),a.$addView(g,f),d.bind("$destroy",function(){a.$destroy(f)}))}}},c}])}])}(window,window.angular),function(a){angular.module("vviewport.vpage").run(["$targets","$state","$stateParams",function(a,b,c){a.setRefreshCall(function(){b.transitionTo(b.current,c,{reload:!0,inherit:!0,notify:!0})})}])}(window);